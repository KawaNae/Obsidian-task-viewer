## 記法

基本構成として`@start>end>deadline`という構成をとる
start、end、deadlineはYYYY-MM-DDの形式で指定する
具体的には以下の7パターンで使用できる
```markdown
- [ ] @2001-11-11>2001-11-12>2001-11-13 <!--完全な記法(SED型)-->

- [ ] @2001-11-11>2001-11-12 <!--締め切りの省略(SE型)-->
- [ ] @2001-11-11>>2001-11-13 <!--終了の省略(SD型)-->
- [ ] @>2001-11-12>2001-11-13 <!--開始の省略、開始の省略は今日の開始だとみなす(ED型)-->

- [ ] @2001-11-11 <!--開始のみの指定(S-All型)-->
- [ ] @>2001-11-12 <!--終了のみの指定、開始は今日であるとみなす(E型)-->
- [ ] @>>2001-11-13 <!--締め切りのみの指定、開始は今日であるとみなす(D型)-->
```

さらに時刻を指定する場合はYYYY-MM-DDTHH:mmまたはHH:mmの形式で指定する。日付を省略できる場合はなるべく省略することを推奨する
```markdown
- [ ] @2001-11-11T12:00 <!--開始のみの指定(S-Timed型)-->
- [ ] @2001-11-11T12:00>13:00 <!--終了の日付を省略した場合は開始の日付と同一だと扱う-->
- [ ] @2001-11-11T12:00>2001-11-12T12:00 <!--終了の日付を書いても良い-->
- [ ] @2001-11-11T12:00>12:00>2001-11-13T12:00 <!--締め切りの日付は省略しない-->
- [ ] @2001-11-11T12:00>2001-11-12T12:00>2001-11-13T12:00 <!--時刻を含めて完全な記法(SED)-->
```

startについては、開始日が未定であることの表現として`future`を用意する
```markdown
- [ ] @future <!--いつでもできるタスク(F型)--> 
```

ただし以下のような使い方は`future`は開始日の省略だと解釈する
```markdown
- [ ] @future>>2001-11-13 <!--D型と同じ扱い-->
- [ ] @future>2001-11-12 <!--E型と同じ扱い-->
- [ ] @future>2001-11-12>2001-11-13 <!--ED型と同じ扱い-->
```

### 期間の計算
タスクの期間は、設定された開始時刻基準を基準として：
1. SED、SE型：startからendまでの実際の時間を計算
2. SD、S-All型：start日の開始時刻から開始時刻+23:59まで（1日=24時間）
3. S-Timed型：start時刻から+1時間（常に1時間=タイムライン表示）
4. E、ED型：ビューの左端の日付の開始時刻をstartとみなす
5. D型：ビューの左端の日付の開始時刻をstart、start+23:59をendとみなす

### 24時間境界の扱い
- 期間が24時間以上（>=24:00）→長期タスク欄
- 期間が24時間未満（<24:00）→タイムライン欄
- 24時間ちょうど（例：12:00-12:00翌日）→長期タスク欄

### タスク配置ルール一覧表

| タスク型 | 時刻の有無 | 期間 | 配置先 |
|---------|-----------|------|--------|
| F | - | - | 未割当欄 |
| SED/SE | あり | >=24h | 長期タスク欄 |
| SED/SE | あり | <24h | タイムライン欄 |
| SED/SE | なし | >=24h | 長期タスク欄 |
| SD/S-All/ED/E/D | - | 常に>=24h | 長期タスク欄 |
| S-Timed | あり | 常に1h | タイムライン欄 |

## タイムラインビュー

タイムラインビューには以下の4つの欄を持つ
1. 未割当タスク欄
2. 日付欄
3. 長期タスク欄
4. タイムライン

またタイムラインビューではタスクの完了、移動ハンドルによるタスクカードの移動、伸縮ハンドルによるタスクのstartとendの更新、右クリックか長押しによるコンテキストメニューの呼び出しができる。UI操作は"UI:操作内容"、コンテキストメニューの内容は"C:操作内容"と表記する。

すべての欄において以下の操作を受け付ける
- UI:タスクの完了
    タスクの状態をdone([ ]=>[x])にする
- C:Delete
    このタスク行をmarkdownファイルから削除
- C:Duplicate
    このタスク行をmarkdownファイルに複製する
- C:Open
    タスクが書かれているmarkdownファイルを開く
- C:パラメータの表示（コンテキストメニュー内に表示する）
    start、end、deadlineの値を表示する。自動設定された値は括弧付きで表示する

### 未割当タスク欄/Future
未割当タスク欄は以下のようなタスクを表示する
- すべてのF型のタスク

F型は以下の操作を受け付ける
- C:Move to All day/UI:移動ハンドルによる未割当タスク欄への移動
    S-All型に変換する。startに今日の日付を追加する。移動ハンドルの場合はUIで指定する
- C:Move to Timeline/UI:移動ハンドルによるタイムライン欄への移動
    S-timed型に変換する。startに今日の日付の時刻を追加する。移動ハンドルの場合はUIで指定する


### 日付欄
日付欄は日付をyyyy-mm-dd(ddd)の形式で表示し、日付をクリックするとdaily noteを開く。ここでの日付は設定によって決められる日付（設定された開始時刻から24時間を一日と扱う）であり、実際の日付とは異なる。

例えば設定では05:00を開始時刻として設定している場合、@2001-11-11T05:00は2001-11-11のタスクだが、@2001-11-11T04:00は2001-11-10のタスクとなる。


### 長期タスク欄/Long Term
長期タスク欄は以下のタスクを表示する
- SED型のうち24時間以上の期間を持つタスク
- SE型のうち24時間以上の期間を持つタスク
- SD型のタスク
- ED型のタスク
- E型のタスク
- D型のタスク
- S-All型のタスク

#### SED型のうち24時間以上の期間を持つタスク
このタイプのタスクは以下の操作を受け付ける
- UI:移動ハンドル操作
    startとendの日付の更新(期間が変化しない)
- UI:伸縮ハンドル操作
    右端伸縮: endの日付を更新する。deadlineは変更しない
    左端伸縮: startの日付を更新する 。deadlineは変更しない

#### SE型のうち24時間以上の期間を持つタスク
このタイプのタスクは以下の操作を受け付ける
- UI:移動ハンドル操作
    startとendの日付の更新(期間が変化しない)
- UI:伸縮ハンドル操作
    右端伸縮: endの日付を更新する。
    左端伸縮: startの日付を更新する。
- C:Move to Future/UI:移動ハンドルによる未割当タスク欄への移動
    F型に変換する。 start全体を`future`に置き換え、end全体を削除する

#### SD型のタスク
このタイプのタスクは以下の操作を受け付ける
- UI:伸縮ハンドル操作
    - 右端伸縮: endの日付を与えてSED型に変換する。deadlineは変更しない    
    - 左端伸縮: startの日付の更新(期間が変化する)。deadlineは変更しない    
    

#### ED型のタスク
このタイプのタスクは以下の操作を受け付ける
- UI:伸縮ハンドル操作
    - 右端伸縮: endの日付の更新(期間が変化する)。deadlineは変更しない
    - 左端伸縮: startの日付を与えてSED型に変換する。deadlineは変更しない

#### E型のタスク
このタイプのタスクは以下の操作を受け付ける
- UI:伸縮ハンドル操作
    - 右端伸縮: endの日付の更新(期間が変化する)
    - 左端伸縮: startの日付を与えてSE型に変換する。
- C:Move to Future/UI:移動ハンドルによる未割当タスク欄への移動
    F型に変換する。 start全体を`future`に置き換え、end全体を削除する

#### D型のタスク
このタイプのタスクは以下の操作を受け付ける
- UI:伸縮ハンドル操作
    - 右端伸縮: endの日付を追加して ED型に変換。deadlineは変更しない
    - 左端伸縮: startの日付を追加して SD型に変換。deadlineは変更しない


#### S-All型のタスク
このタイプのタスクは以下の操作を受け付ける
- UI:伸縮ハンドル操作
    - 右端伸縮: endの日付を追加して SE型に変換
    - 左端伸縮: startの日付を更新（S-All型のまま、期間は1日で一定）
- UI:移動ハンドル操作
    startの日付の更新(期間が変化しない)
- C:Move to Timeline`/UI:移動ハンドルによるタイムライン欄への移動
    S-timed型に変換する。startに時刻を追加し、追加する時刻はタイムライン上で指定する。
- C:Move to Future/UI:移動ハンドルによる未割当タスク欄への移動
    F型に変換する。start全体を`future`に置き換える

### タイムライン欄/Timeline
タイムライン欄は以下の3種類のタスクを表示する。それぞれタイムライン上を動かすことで移動と伸縮などが可能であり、それに従ってstartとendが更新される。deadlineがある場合ははそのまま保持される。タイプに関わらず以下の操作を受け付ける
- UI:伸縮ハンドル操作
    上端伸縮: start時刻と日付の更新(期間が変化する)、deadlineは変更しない
    下端伸縮: end時刻と日付の更新(期間が変化する)、deadlineは変更しない
- UI:移動ハンドル操作
    startとendの時刻と日付の更新(期間が変化しない)

#### SED型のうち24時間未満の期間を持つタスク（24時間未満ということは時刻を持っている）
このタイプは追加で以下の操作を受け付ける
- C:Move to Long Term/UI:移動ハンドルによる長期タスク欄への移動
    D型に変換する。start全体とend全体を削除する（deadlineが残る）

#### SE型のうち24時間未満の期間を持つタスク（24時間未満ということは時刻を持っている）
このタイプは追加で以下の操作を受け付ける
- C:Move to Future/UI:移動ハンドルによる未割当タスク欄への移動
    F型に変換する。 start全体を`future`に置き換え、end全体を削除する
- C:Move to All day/UI:移動ハンドルによる終日タスク欄への移動
    S-All型に変換する。startの時刻とend全体を削除する

#### S-Timed型のタスク
このタイプは追加で以下の操作を受け付ける
- C:Move to Future/UI:移動ハンドルによる未割当タスク欄への移動
    F型に変換する。start全体を`future`に置き換える
- C:Move to All day/UI:移動ハンドルによる終日タスク欄への移動
    S-All型に変換する。startの時刻を削除する


## UI操作
タスクの移動については、未割当タスク欄(FU)、長期タスク欄(LT)、タイムライン(TL)の間を行き来する。
移動は以下のいずれかを行う。
- FU->LT
ドラッグ&ドロップでタスクカードを持ち、浮遊タスクカードになる。浮遊タスクカードはマウスに追従してLTエリアに移動できる。LTエリアはその日の欄全体がハイライトされる。どの日にドロップするかで、S-All型またに変換する。
- FU->TL
ドラッグ&ドロップでタスクカードを持ち、浮遊タスクカードになる。浮遊タスクカードはマウスに追従してTLエリアに移動できる。TLエリアのどこにドロップするかでstartを指定してS-Timed型に変換する。

- LT->TL
ドラッグ&ドロップでタスクカードを持ち、浮遊タスクカードになる。浮遊タスクカードはマウスに追従してTLエリアに移動できる。TLエリアのどこにドロップするかでstartを指定してS-Timed型に変換する。このときend全体は削除し、deadlineがある場合はSD型にする

- LT->FU
ドラッグ&ドロップでタスクカードを持ち、浮遊タスクカードになる。浮遊タスクカードはマウスに追従してFUエリアに移動できる。deadlineがある場合はこの操作を許容しない。startを`future`に置き換えて、end全体を削除する。

- TL->FU
ドラッグ&ドロップでタスクカードを持ち、浮遊タスクカードになる。浮遊タスクカードはマウスに追従してFUエリアに移動できる。deadlineがある場合はこの操作を許容しない。startを`future`に置き換えて、end全体を削除する。

